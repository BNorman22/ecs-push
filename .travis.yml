sudo: required
services:
  - docker

before_install:
  - "sudo curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest"
  - "sudo chmod +x /usr/local/bin/ecs-cli"
  - "ecs-cli configure --region us-west-2 --access-key $AWS_ACCESS_KEY_ID --secret-key $AWS_SECRET_ACCESS_KEY --cluster hacko-service"
script:
  - docker-compose run web python manage.py test

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
      docker login --username "$DOCKER_USERNAME" --password "$DOCKER_PASSWORD" &&
      docker push pdxdiver/django-web ;
      ecs-cli compose --project-name ecs-hacko --user --file ecs-deploy.yml service up
    fi
